<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Title</title>
    <link href="other_lib/http_cdn.jsdelivr.net_npm_bootstrap@5.3.0-alpha1_dist_css_bootstrap.css" rel="stylesheet">
    <script src="other_lib/http_cdn.jsdelivr.net_npm_bootstrap@5.3.0-alpha1_dist_js_bootstrap.bundle.js"></script>
    <script src="other_lib/echarts.js"></script>
</head>
<body>
<div style="width: 50%; margin: 0 auto; text-align: center; margin-top: 50px;">
    <img style="margin-left: -5%; margin-top: 50px" src="other_lib/img.png">
    <h1 style="margin-left: -5%; margin-top: 50px; font-size: 50px">漏洞扫描安全评估报告</h1>
</div>
<div style="width: 50%; margin: 0 auto; margin-bottom: 33%; margin-top: 50px; border: 1px solid darkgray; border-radius: 10px; padding: 2px">
    <div class="accordion" id="accordionPanelsStayOpenExample">
        <div class="accordion-item">
            <h2 class="accordion-header" id="panelsStayOpen-headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true"
                        aria-controls="panelsStayOpen-collapseOne"
                        style="font-size: 20px">
                    目录
                </button>
            </h2>
            <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show"
                 aria-labelledby="panelsStayOpen-headingOne">
                <div class="accordion-body" style="margin: 3%; font-size: 18px">
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link" href="#"
                                                onclick="openReferencePanel('Two')">1.扫描结果概述</a></li>
                        <li class="nav-item"><a class="nav-link" href="#"
                                                onclick="openReferencePanel('Three')">2.目标主机信息</a></li>
                        <li class="nav-item"><a class="nav-link" href="#"
                                                onclick="openReferencePanel('Four')">3.漏洞详情</a></li>
                        <li class="nav-item"><a class="nav-link" href="#"
                                                onclick="openReferencePanel('Five')">4.参考标准</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="panelsStayOpen-headingTwo">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false"
                        aria-controls="panelsStayOpen-collapseTwo"
                        style="font-size: 20px">
                    1.扫描结果概述
                </button>
            </h2>
            <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse"
                 aria-labelledby="panelsStayOpen-headingTwo">
                <div class="accordion-body">
                    <div style="width: 80%; margin: 0 auto">
                        <p style="text-indent:2em;">
                            本次扫描共扫描软件包<code id="pkg_num"></code>个，目标主机<code id="hostname"></code>共检测出漏洞<code
                                id="vul_total"></code>个，其中严重漏洞<code id="vul_lever1"></code>个，高危漏洞<code
                                id="vul_lever2"></code>个，中危漏洞<code id="vul_lever3"></code>个，低危漏洞<code
                                id="vul_lever4"></code>个，修复漏洞数量<code
                                id="fixed_num"></code>个。（漏洞风险等级的分类请参阅目录4 参考标准）。
                        </p>
                        <hr>
                        <p style="text-indent:2em;">
                            本次任务中，漏洞按严重、高、中、低等级分布结构如下图所示。漏洞等级分布图如下所示：</p>
                        <div id="pieChart" style="width: 700px; height: 400px;margin: 0 auto"></div>
                        <hr>
                        <p style="text-indent:2em;">漏洞年份统计如下所示：</p>
                        <div id="barChart" style="width: 400px; height: 400px;margin: 0 auto"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="panelsStayOpen-headingThree">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseThree" aria-expanded="false"
                        aria-controls="panelsStayOpen-collapseThree"
                        style="font-size: 20px">
                    2.主机信息
                </button>
            </h2>
            <div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse"
                 aria-labelledby="panelsStayOpen-headingThree">
                <div class="accordion-body">
                    <div style="margin: 0 auto; width: 60%">
                        <dl class="row">
                            <dt class="col-sm-3">扫描器版本</dt>
                            <dd class="col-sm-9" id="scaner_version">A01</dd>
                            <hr/>
                            <dt class="col-sm-3">目标主机IP</dt>
                            <dd class="col-sm-9" id="ip_info"></dd>
                            <hr/>
                            <dt class="col-sm-3">目标主机用户</dt>
                            <dd class="col-sm-9" id="username_info"></dd>
                            <hr/>
                            <dt class="col-sm-3">扫描开始日期</dt>
                            <dd class="col-sm-9" id="date_info_begin"></dd>
                            <hr/>
                            <dt class="col-sm-3">扫描结束日期</dt>
                            <dd class="col-sm-9" id="date_info_end"></dd>
                            <hr/>
                            <dt class="col-sm-3">扫描用时</dt>
                            <dd class="col-sm-9" id="time_consume"></dd>
                            <hr/>
                            <dt class="col-sm-3 text-truncate">目标主机系统</dt>
                            <dd class="col-sm-9" id="version_info"></dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="panelsStayOpen-headingFour">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseFour" aria-expanded="false"
                        aria-controls="panelsStayOpen-collapseFour"
                        style="font-size: 20px">
                    3.漏洞详情
                </button>
            </h2>
            <div id="panelsStayOpen-collapseFour" class="accordion-collapse collapse"
                 aria-labelledby="panelsStayOpen-headingFour">
                <div class="accordion-body" style="width: 80%; margin: 0 auto">
                    <div class="accordion" id="accordionPanelsStayOpen">

                    </div>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="panelsStayOpen-headingFive">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseFive" aria-expanded="false"
                        aria-controls="panelsStayOpen-collapseFour"
                        style="font-size: 20px">
                    4.参考标准
                </button>
            </h2>
            <div id="panelsStayOpen-collapseFive" class="accordion-collapse collapse"
                 aria-labelledby="panelsStayOpen-headingFive">
                <div class="accordion-body">
                    <div style="margin: 0 auto; width: 50%">
                        <table class="table">
                            <thead>
                            <tr>
                                <th scope="col">资产风险等级</th>
                                <th scope="col">资产风险值区域</th>
                            </tr>
                            </thead>
                            <tbody class="table-group-divider">
                            <tr>
                                <th scope="row">
                                    <button class="btn btn-sm" type="button" style="background-color: #960000; color: white">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                             fill="currentColor" class="bi bi-shield-exclamation" viewBox="0 0 16 16">
                                            <path d="M5.338 1.59a61.44 61.44 0 0 0-2.837.856.481.481 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.725 10.725 0 0 0 2.287 2.233c.346.244.652.42.893.533.12.057.218.095.293.118a.55.55 0 0 0 .101.025.615.615 0 0 0 .1-.025c.076-.023.174-.061.294-.118.24-.113.547-.29.893-.533a10.726 10.726 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067c-.53 0-1.552.223-2.662.524zM5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.775 11.775 0 0 1-2.517 2.453 7.159 7.159 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7.158 7.158 0 0 1-1.048-.625 11.777 11.777 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 62.456 62.456 0 0 1 5.072.56z"/>
                                            <path d="M7.001 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.553.553 0 0 1-1.1 0L7.1 4.995z"/>
                                        </svg>
                                        严重漏洞
                                    </button>
                                </th>
                                <td>9 <= 漏洞评分 <= 10</td>
                            </tr>
                            <tr>
                                <th scope="row">
                                    <button class="btn btn-sm" type="button" style="background-color: #ff0000">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                             fill="currentColor" class="bi bi-shield-exclamation" viewBox="0 0 16 16">
                                            <path d="M5.338 1.59a61.44 61.44 0 0 0-2.837.856.481.481 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.725 10.725 0 0 0 2.287 2.233c.346.244.652.42.893.533.12.057.218.095.293.118a.55.55 0 0 0 .101.025.615.615 0 0 0 .1-.025c.076-.023.174-.061.294-.118.24-.113.547-.29.893-.533a10.726 10.726 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067c-.53 0-1.552.223-2.662.524zM5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.775 11.775 0 0 1-2.517 2.453 7.159 7.159 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7.158 7.158 0 0 1-1.048-.625 11.777 11.777 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 62.456 62.456 0 0 1 5.072.56z"/>
                                            <path d="M7.001 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.553.553 0 0 1-1.1 0L7.1 4.995z"/>
                                        </svg>
                                        高危漏洞
                                    </button>
                                </th>
                                <td>7 <= 漏洞评分 < 9</td>
                            </tr>
                            <tr>
                                <th scope="row">
                                    <button class="btn btn-sm" type="button" style="background-color: #f79646">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                             fill="currentColor" class="bi bi-shield-exclamation" viewBox="0 0 16 16">
                                            <path d="M5.338 1.59a61.44 61.44 0 0 0-2.837.856.481.481 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.725 10.725 0 0 0 2.287 2.233c.346.244.652.42.893.533.12.057.218.095.293.118a.55.55 0 0 0 .101.025.615.615 0 0 0 .1-.025c.076-.023.174-.061.294-.118.24-.113.547-.29.893-.533a10.726 10.726 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067c-.53 0-1.552.223-2.662.524zM5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.775 11.775 0 0 1-2.517 2.453 7.159 7.159 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7.158 7.158 0 0 1-1.048-.625 11.777 11.777 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 62.456 62.456 0 0 1 5.072.56z"/>
                                            <path d="M7.001 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.553.553 0 0 1-1.1 0L7.1 4.995z"/>
                                        </svg>
                                        中危漏洞
                                    </button>
                                </th>
                                <td>4 <= 漏洞评分 < 7</td>
                            </tr>
                            <tr>
                                <th scope="row">
                                    <button class="btn btn-sm" type="button" style="background-color: #ffc000">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                             fill="currentColor" class="bi bi-shield-exclamation" viewBox="0 0 16 16">
                                            <path d="M5.338 1.59a61.44 61.44 0 0 0-2.837.856.481.481 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.725 10.725 0 0 0 2.287 2.233c.346.244.652.42.893.533.12.057.218.095.293.118a.55.55 0 0 0 .101.025.615.615 0 0 0 .1-.025c.076-.023.174-.061.294-.118.24-.113.547-.29.893-.533a10.726 10.726 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067c-.53 0-1.552.223-2.662.524zM5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.775 11.775 0 0 1-2.517 2.453 7.159 7.159 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7.158 7.158 0 0 1-1.048-.625 11.777 11.777 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 62.456 62.456 0 0 1 5.072.56z"/>
                                            <path d="M7.001 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.553.553 0 0 1-1.1 0L7.1 4.995z"/>
                                        </svg>
                                        低危漏洞
                                    </button>
                                </th>
                                <td>0 <= 漏洞评分 < 4</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <br>
                    <div style="margin: 0 auto; width: 90%">
                        <p>
                            <strong>漏洞等级说明：</strong><br>
                            （1）严重漏洞： 具有极高威胁，可能导致系统完全失控，需要立即修复或隔离以防潜在的灾难性后果。<br>
                            （2）高危漏洞： 具有较高潜在威胁，需要尽快修复，可能导致系统被攻击者控制或敏感信息泄露。<br>
                            （3）中危漏洞：
                            威胁相对较低，需要有计划地修复，可能需要特定条件才能成功利用，对系统整体威胁较小。<br>
                            （4）低危漏洞：
                            威胁程度相对较小，修复在计划中进行，通常只影响系统的一小部分，需要综合考虑优先级。<br>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    function openReferencePanel(index) {
        // 触发参考标准面板的展开
        var referencePanel = document.getElementById('panelsStayOpen-collapse' + index);
        // 判断面板的状态
        if (referencePanel.classList.length === 2) {
            // 延迟执行滚动到指定元素
            setTimeout(function () {
                referencePanel.scrollIntoView({behavior: 'smooth'});
            }, 0);
        }
        var accordion = new bootstrap.Collapse(referencePanel);
        accordion.toggle();
    }

    // 基于准备好的dom，初始化echarts实例
    var myChart1 = echarts.init(document.getElementById('barChart'));
    var barX = []
    var barXdata = []
    // 指定图表的配置项和数据
    var option1 = {
        xAxis: {
            data: barX
        },
        yAxis: {},
        series: [
            {
                type: 'bar',
                data: barXdata,
                barWidth: '40%'
            }
        ]
    };
    // 使用刚指定的配置项和数据显示图表。
    myChart1.setOption(option1);


    var mychart2 = echarts.init(document.getElementById('pieChart'))
    var piedata = []
    var option2 = {
        legend: {
            orient: 'vertical',
            x: 'right',
            data: ['严重漏洞', '高危漏洞', '中危漏洞', '低危漏洞']
        },
        series: [
            {
                type: 'pie',
                radius: ['40%', '70%'],
                avoidLabelOverlap: true,
                label: {
                    show: true,
                    position: 'outside',  // 设置为 'outside'，使标签显示在饼图外部
                    formatter: '{b}: {d}%',  // 设置标签格式，显示名称和占比
                    fontSize: 14,
                    fontWeight: 'bold'
                },
                labelLine: {
                    show: true
                },
                emphasis: {
                    label: {
                        show: true,
                        fontSize: '20',
                        fontWeight: 'bold'
                    }
                },
                data: piedata
            }
        ]
    };
    mychart2.setOption(option2)


    // Sample data for accordion items
    const accordionData = [];

    // Get the accordion container
    const accordionContainer = document.getElementById('accordionPanelsStayOpen');

    // Loop through the data and create accordion items
    accordionData.forEach(item => {
        // Create a new accordion item
        const newAccordionItem = document.createElement('div');
        newAccordionItem.classList.add('accordion-item');

        // Set the color based on the score
        const color = getColorBasedOnScore(parseFloat(item.score));

        if(item.score === '-1')
            item.score = "None"

        newAccordionItem.innerHTML = `
            <h2 class="accordion-header" id="panelsStayOpen-heading${item.id}">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapse${item.id}" aria-expanded="false"
                        aria-controls="panelsStayOpen-collapse${item.id}">
                    <strong style="color: ${color}">${item.cveid} (${item.source})</strong>
                </button>
            </h2>
            <div id="panelsStayOpen-collapse${item.id}" class="accordion-collapse collapse"
                 aria-labelledby="panelsStayOpen-heading${item.id}">
                <div class="accordion-body">
                    <dl class="row">
                        <dt class="col-sm-3">漏洞 ID</dt>
                        <dd class="col-sm-9">${item.cveid}</dd>
                        <hr>
                        <dt class="col-sm-3">受影响软件包</dt>
                        <dd class="col-sm-9">${item.source}</dd>
                        ${item.affectPkg ? '<hr><dt class="col-sm-3">受影响二进制包</dt><dd class="col-sm-9">' + item.affectPkg + '</dd>' : ''}
                        <hr>
                        <dt class="col-sm-3">漏洞评分</dt>
                        <dd class="col-sm-9" style="color: ${color}">${item.score} (${item.level})</dd>
                        <hr>
                        <dt class="col-sm-3">漏洞状态</dt>
                        ${item.is_fixed === 'True' ? '<dd class="col-sm-9" style="color: #20c997">已修复</dd>' : '<dd class="col-sm-9" style="color: #ff0013">未修复</dd>'}
                        <hr>
                        <dt class="col-sm-3">漏洞描述</dt>
                        <dd class="col-sm-9">${item.description}</dd>
                        <hr>
                        <dt class="col-sm-3">修复建议</dt>
                        <dd class="col-sm-9">${item.fix_suggest}</dd>
                        <hr>
                        <dt class="col-sm-3">参考链接</dt>
                        <dd class="col-sm-9">${item.reference_link}</dd>
                    </dl>
                </div>
            </div>
        `;

        // Append the new accordion item to the accordion container
        accordionContainer.appendChild(newAccordionItem);
    });

    // Function to get color based on the score
    function getColorBasedOnScore(score) {
        if (score >= 9) {
            return '#960000'; // or any color you prefer for high scores
        } else if (score >= 7) {
            return '#ff0000'; // or any color you prefer for moderate scores
        } else if (score >= 4) {
            return '#f79646'; // or any color you prefer for low scores
        } else {
            return '#ffc000'
        }
    }
</script>
</body>
</html>